**Reference**
- 면접을 위한 CS 전공지식 노트 (주홍철, 길벗출판사)
- https://helloworld-japan.tistory.com/33
- https://inpa.tistory.com/entry/%F0%9F%91%A9%E2%80%8D%F0%9F%92%BB-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%E2%9A%94%EF%B8%8F-%EC%93%B0%EB%A0%88%EB%93%9C-%EC%B0%A8%EC%9D%B4
- https://github.com/WooVictory/Ready-For-Tech-Interview/blob/master/Operating%20System/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80%20%EC%8A%A4%EB%A0%88%EB%93%9C.md
- https://github.com/gyoogle/tech-interview-for-developer/blob/master/Computer%20Science/Operating%20System/Process%20vs%20Thread.md

***

> **프로그램이란?** <br>
어떤 작업을 위해 실행할 수 있는 파일을 말한다.

## Process 란?
- **컴퓨터에서 실행되고 있는 프로그램**을 말하고, CPU 스케쥴링의 대상이 되는 Task와 거의 같은 의미로 쓰인다.
- 운영체제로부터 시스템 자원을 할당받는다.
- 프로그램이 메모리에 올라가면 프로세스가 되는 인스터스화가 일어난다.
  이후 운영체제의 CPU 스케쥴러에 따라 CPU가 프로세스를 실행한다.


### Process의 상태

1. 생성상태 create <br>
   프로세스가 생성된 상태를 의미하며 fork() 또는 exec() 함수를 통해 생성한다. 이때 PCB가 할당된다.
    - fork() : 부모 프로세스의 주소 공간을 그대로 복사하며, 새로운 자식 프로세스를 생성하는 함수이다. 주소 공간만 복사할 뿐이지 부모 프로세스의 비동기 작업등을 상속하지는 않는다.
    - exec() : 새롭게 프로세스를 생성하는 함수.


2. 대기상태 ready<br>
   대기상태는 메모리 공간이 충분하면 메모리를 할당받고 아니면 아닌 상태로 대기하고 있으며 CPU 스케쥴러로부터 CPU 소유권이 넘어오기를 기다리는 상태

3. 대기 중단 상태 ready suspended <br>
   메모리 부족으로 일시 중단된 상태

4. 실행 상태 running<br>
   CPU 소유권과 메모리를 할당받고 인스트럭션을 수행 중인 상태를 의미.  -> CPU burst 가 일어났다고 표현

5. 중단 상태 blocked<br>
   어떤 이벤트가 발생한 이후 기다리며 프로세스가 차단된 상태.

6. 일시 중단 상태 blocked suspended<br>
   대기 중단과 유사. 중단된 상태에서 프로세스가 실행되려고 했지만 메모리 부족으로 일시 중단된 상태

7. 종료 상태 terminated<br>
   메모리와 CPU 소유권을 모두 놓고 가는 상태. 종료는 자연스럽게 종료되는 것도 있지만 부모 프로세스가 자식 프로세를 강제시키는 비자발적 종료(abort)로 종료되는 것도 있다.
   자식 프로세스에 할당된 자원의 한계치를 넘어서거나 부모 프로세스가 종료되거나 사용자가 process.kill 등 여러 명령어로 프로세스를 종료할 때 발생한다.


### Process의 메모리 구조
![](https://velog.velcdn.com/images/ehddk0133/post/070acd45-4db2-4dd5-9a55-83aa6a3efc53/image.png)

위 이미지와 같은 프로세스 메모리 구조를 기반으로 운영체제가 프로세스에 적절한 메모리를 할당한다. (프로세스는 각각 별도의 메모리 영역(주소공간)을 할당받는다.)
스택은 위 주소부터 할당, 힙은 아래 주소부터 할당된다. 스택과 힙은 동적 할당이 되고, 동적 할당은 런타임 단계에서 메모리를 할당받는 것을 말한다.

1. **스택**
- 지역변수, 매개변수, 실행되는 함수에 의해 늘거나 줄어드는 메모리 영역.
- 함수가 호출될 때마다 호출될 때의 환경 등 특정 정보가 스택에 계속해서 저장.
- 재귀 함수가 호출된다고 했을 때 새로운 스택 프레임이 매번 사용되기 떄문에 함수 내의 변수 집합이 해당 함수의 다른 인스턴스 변수를 방해하지 않는다.
2. **힙**
- 동적으로 할당되는 변수들을 담는다.
- 동적으로 관리되는 자료 구조의 경우 힙 영역을 사용
- 프로그래머가 직접 공간을 할당, 해제하는 메모리 공간이다. (메모리 구조에 대해 추가 정리 필요)

3. **데이터 영역**
- 정적 할당되는 영역으로, 컴파일 단계에서 메모리를 할당하는 것을 말한다.
- 데이터 영역은 BSS segment, Data segment, code/text segment로 나뉘어서 저장된다.

4. **코드 영역**
- 실행할 프로그램의 코드가 저장되는 영역 = 텍스트 영역
- CPU는 코드 영역에 저장된 명령을 하나씩 가져가서 처리하고, 프로그램이 종료될 때까지 메모리에 계속 남아있는다.

### PCB (Process Control Block; 프로세스 제어 블록)
- 운영체제에서 프로세스에 대한 메타데이터를 저장한 '데이터'를 말한다.
- 특정 프로세스에 대한 중요한 정보를 저장하고 있는 커널 내의 자료구조이다.


- 프로세스가 생성되면 운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유한 PCB를 생성한다.
- 프로그램이 실행되면 프로세스가 생성되고 프로세스 주소 값들에 스택, 힙 등의 구조를 기반으로 메모리가 할당된다.
- 이 프로세스의 메타 데이터들이 PCB에 저장되어 관리된다.
- 이는 프로세스의 중요한 정보를 포함하고 있기 때문에 일반 사용자가 접근하지 못하도록 커널 스택의 가장 앞부분에서 관리된다.

> 프로세스는 CPU를 할당받아 작업을 처리 -> 프로세스 전환이 발생하면 진행하던 작업을 저장하고 CPU 반환. -> 이때 작업의 진행 상황을 모두 PCB에 저장. -> 다시 CPU를 할당받게 되면 PCB에 저장되었던 내용을 불러와서 종료지점부터 다시 작업을 수행



### Multi Process 멀티 프로세스
- 여러 개의 '프로세스'를 통해 동시에 두 가지 이상의 일을 수행할 수 있는 것을 말한다.
  = 하나의 응용 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 하나의 작업을 처리하도록 하는 것
- 멀티 프로세스를 통해 하나 이상의 일을 병렬로 처리할 수 있으며 특정 프로세스의 메모리, 프로세스 중 일부에 문제가 발생되더라도 다른 프로세스를 이용해서 처리할 수 있어 신뢰성이 높다.
- 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근할 수 없으며, 접근을 위해서 IPC 통신이 필요하다.
- 프로세스는 각 독립된 메모리 영역을 할당받았기 때문에 공유하는 메모리가 없어서 적업량이 많을 수록 오버헤드가 발생한다. (= Context Switching 으로 인한 성능 저하)

> **IPC (Inter Process Communication)**
> - 프로세스끼리 데이터를 주고받고 공유 데이터를 관리하는 매커니즘을 말한다. <br>
  ex) 클라이언트가 데이터 요청 -> 서버가 요청에 응답함 
> - 공유 메모리, 파일, 소켓, 명명된 파이프, 메시지 큐 등이 있으며, 메모리가 완전히 공유되는 스레드보다 속도가 떨어진다. (이 글에선 설명하지 않는다.)

> **Context Switching** <br>
> - 프로세스의 상태 정보를 저장하고 복원하는 일련의 과정을 말한다. 
> - 동작중인 프로세스가 대기하면서 해당 프로세스 상태를 보관하고, 대기하던 다음 순서의 프로세스 동작하면서 이전에 보관했던 프로세스 상태를 복구하는 과정


## Thread 란?
- 프로세스 내 작업의 흐름을 말한다.
- 프로세스의 실행 가능한 가장 작은 단위이다. (= 프로세스 실행 단위)
- **프로세스는 여러 스레드를 가질 수 있다.**
- 한 프로세스 내에서 동작되는 여러 실행 흐름으로 프로세스 내의 주소 공간이나 자원을 공유할 수 있다. 따라서 한 스레드가 프로세스의 자원을 변경하면, 다른 스레드도 그 변경 결과를 즉시 확인할 수 있다.
- code, data, stack, heap을 각각 생성하는 프로세스와 다르게 스레드는 code, data, heap은 스레드끼리 서로 공유한다. 그 외의 영역(Stack)은 각각 생성된다.


> **동시성이란?** <br>
서로 독립적인 작업들을 작은 단위로 나누고 동시에 실행되는 것처럼 보여주는 것


### Multi Thread 멀티 스레드
- 멀티스레딩은 프로세스 내 작업을 여러 개의 스레드로 구성하고 각 스레드가 하나의 작업을 처리하도록 하는 것이다.
- 스레드끼리 서로 자원을 공유하기 때문에 효율성이 높다.
- 대표적인 예시로 웹 서버가 있다.
- 서로 다른 스레드가 영역을 공유하기 때문에 다른 스레드에서 사용중인 변수나 자료에 접근해서 다른 값을 읽어오거나 수정할 수도 있다. (= 동기화 문제)
- 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받기때문에 설계 단계에서 주의가 필요하며, 디버깅이 어렵다.




***

## 정리

|구분 |프로세스|스레드|
|:---:|:---:|:---:|
|정리|프로그램을 메모리 상에서 실행중인 작업 <br> 자신만의 고유 공간과 자원을 할당받아 사용하는 작업의 단위|프로세스 안에서 실행되는 여러 흐름의 단위 <br> 다음 스레드와 프로세스의 자원과 공간을 공유하면서 사용|


<br>

|구분 |멀티 프로세스|멀티 스레드|
|:---:|:---:|:---:|
|정리| 하나의 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것 |하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것. <br>스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해준다.|
|장점|자식 프로세스 중 한개에 문제가 발생해도 다른 영향이 확산되지 않는다.<br> (안정성)|메모리 공간과 시스템 자원 소모가 줄어들게 된다.<br> Context switching시 캐시 메모리를 비울 필요가 없기 때문에 비용이 적고 더 빠르다. 그래서 시스템의 처리량이 향상되고 자원 소모가 줄어서 프로그램의 응답 시간이 단축된다. |
|단점|각각 독립된 메모리 영역을 가지고 있어서 작업량이 많을 수록 오버헤드 발생.|공유 메모리를 갖기 때문에 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.|
