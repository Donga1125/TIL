## 1. 기본 SQL 작성

### 1) 데이터 정의어 DDL

- DDL 대상
    - 도메인: 하나의 속성이 가질 수 있는 원자값들의 집합
    - 스키마: 데이터베이스의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
    - 테이블: 데이터를 저장하는 항목인 필드로 구성된 데이터의 집합체
    - 뷰: 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
    - 인덱스: 검색을 빠르게 하기 위한 데이터 구조
- CREATE  TABLE 속성(제약조건)
    - PRIMARY KEY: 테이블의 기본 키를 정의. 유일하게 테이블의 각 행을 식별
    - FOREIGN KEY: 외래 키를 정의.  참조 대상을 테이블(컬럼명)로 명시. 열과 참조된 테이블의 열 사이의 외래 키 관계를 적용하고 설정
    - UNIQUE: 해당 컬럼에 동일한 값이 들어가지 않도록 하는 제약조건
    - NOT NULL: 해당 컬럼은 NULL값을 포함하지 않도록 하는 속성
    - CHECK: 개발자가 정의하는 제약조건. 참이어야하는 조건을 지정.
    - DEFAULT: 해당 필드의 기본값을 설정

### 2) 트랜잭션

- **Transaction의 특징**
    - **원자성 Atomicity**
        - 트랜잭션을 구성하는 연산 전체가 모두 정상적으로 실행되거나, 모두 취소되어야하는 성징
        - 트랜잭션의 연산 전체가 성공 또는 실패 (All or Noting)되어야하는 성질
        - 주요 기법: Commit/Rollback, 회복성 보장

    - **일관성 Consistency**
        - 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야하는 성질
        - 주요 기법: 무결성 제약조건, 동시성 제어

    - **격리성 = 고립성 Isolation**
        - 동시에 실행되는 트랜잭션들이 서로 영향을 미치지 않아야한다는 성질
        - 주요 기법: Read Uncommitted, Read Committed, Repeatable Read, Serializable

    - **영속성 Durability**
        - 성공이 완료된 트랜잭션의 결과는 영속적으로 데이터베이스에 저장되어야 하는 성질
        - 주요 기법: 회복 기법

- **병행 제어**
    - 병행 제어는 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, 데이터베이스 일관성 유지를 위해 상호작용을 제어하는 기법이다.
    - 병행 제어의 목적:
        - 데이터베이스의 공유를 최대화 : 여러 사용자가 동시에 데이터베이스에 접근할 수 있도록해서 데이터베이스의 공유를 최대화
        - 시스템의 활용도를 최대화 : 시스템 내의 CPU, 메모리, 디스크 등과 같은 자원을 효율적으로 활용
        - 데이터베이스의 일관성을 유지 : 동시에 실행되는 트랜잭션 간에 데이터의 상태나 값이 일관되고 모순되지 않는 상태를 유지
        - 사용자에 대한 응답시간을 최소화 : 여러 사용자에 대한 응답시간을 최소화하는 것을 목표로 동작

    - **병행 제어 기법의 종류**
        - **로킹 Locking**
            - 하나의 트랜잭션이 실행하는 동안 특정 데이터 항목에 대해서 다른 트랜잭션이 동시에 접근하지 못하도록 상호 배제 기능을 제공하는 기법
            - 데이터베이스, 파일, 레코드 등은 로킹 단위가 될 수 있음
            - 로킹 단위가 작아지면 데이터베이스 공유도가 증가
            - 로킹 단위가 작아지면 로킹 오버헤드 증가
            - 한꺼번에 로킹할 수 있는 객체의 크기를 로킹 단위라고 함.
            - 로킹 단위가 커지만 병행성 수준이 낮아짐.

        - **2PC (2 Phase Commit)**
            - 데이터베이스 동시성 제어 기술 중 하나로, 여러 개의 분산 데이터베이스 시스템에서 트랜잭션의 일관성을 유지하기 위한 기법
            - 트랜잭션을 두 단계로 분리하여 제어
                - 1단계 (준비 단계)- 트랜잭션 수행 결과를 다른 분산 시스템에 알리는 과정
                - 2단계 (커밋 단계)- 모든 분산 시스템에서 트랜잭션 수행 결과가 일치하는지 확인하는 과정. 모든 분산 시스템이 트랜잭션을 성공적으로 수행했다면, 커밋을 수행하고 그렇지 않다면 롤백을 수행

        - **낙관적 검증 Optimistic Validation**
            - 트랜잭션이 어떠한 검증도 수행하지 않고 일단 트랜잭션을 수행하고, 트랜잭션 종료 시 검증을 수행하여 데이터베이스에 반영하는 기법

        - **타임 스탬프 순서 Time Stamp Ordering**
            - 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해 트랜잭션이 실행을 시작하기 전에 타임 스탬프를 부여하여 부여된 시간에 따라 트랜잭션 작업을 수행하는 기법

        - **다중 버전 동시성 제어 (MVCC; Mutil Version Concurrency Control)**
            - 트랜잭션의 타임스탬프와 접근하려는 데이터의 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근하도록 하는 기법

- **회복 기법 (영속성 주요 기법)**
    - 회복 기법은 트랜잭션을 수행하는 도중 장애로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 복구시키는 작업이다.
    - 회복 기법 종류
        - 로그 기반 회복 기법
            - 지연 갱신 회복 기법 : 트랜잭션이 완료되기 전까지 데이터베이스에 기록하지 않는 기법
            - 즉각 갱신 회복 기법: 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법
        - 체크포인트 회복 기법 : 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원시키는 회복 기법
        - 그림자 페이징 회복 기법: 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법

- 트랜잭션의 상태 변화

  ![트랜잭션_상태전이도.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/c52d3ba8-5d60-4225-b490-d52786f48aed/cbf30e23-90f0-46da-85a1-5355a1755b7e/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98_%EC%83%81%ED%83%9C%EC%A0%84%EC%9D%B4%EB%8F%84.png)

    - 활성 상태 (Active): 초기 상태, 트랜잭션이 실행 중일 때 가지는 상태
    - 부분 완료 상태 (Partially Committed): 마지막 명령문이 실행된 후에 가지는 상태. 모든 연산의 처리는 끝났지만 트랜잭션이 수행한 최종 결과를 데이터베이스에 반영하지 않은 상태
    - 완료 상태 (Committed): 트랜잭션이 성공적으로 완료된 후 가지는 상태
    - 실패 상태 (Failed) : 정상적인 실행이 더 이상 진행될 수 없을 때 가지는 상태
    - 철회 상태 (Aborted) : 트랜잭션이 취소되고 데이터베이스가 트랜잭션 시작 전 상태로 환원된 상태. 트랜잭션의 수행이 실패하여 Rollback 연산을 실행한 상태


### 2) 고급 SQL 작성

### 1) View

- 뷰의 개념

  ![KakaoTalk_20240123_193558046.jpg](https://prod-files-secure.s3.us-west-2.amazonaws.com/c52d3ba8-5d60-4225-b490-d52786f48aed/2f10aa5d-095c-4898-8aec-480db19231fc/KakaoTalk_20240123_193558046.jpg)

    - 뷰는 논리 테이블로서 사용자에게 (생성 관점 아닌 사용 관점에서 ) 테이블과 동일하다.
    - 위 그림에서 ‘테이블 A’ 와 ‘테이블 B’는 물리 테이블을 의미하고, ‘뷰 C’는 두 개의 테이블을 이용하여 생성한 뷰를 의미한다.
    - 뷰는 ‘테이블 A’와 같은 하나의 물리 테이블로부터 생성 가능하며, 다수의 테이블 또는 다른 뷰를 이용해 만들 수 있다.
    - 뷰와 같은 결과를 만들기 위해  **조인** 기능을 활용할 수 있으나, 뷰가 만들어져 있다면 사용자는 조인 없이 하나의 테이블을 대상으로 하는 단순한 질의어를 사용할 수 있다.

- **뷰의 장단점**
    - **장점**
        - 논리적 독립성 제공: 데이터베이스에 영향을 주지 않고 애플리케이션이 원하는 형태로 데이터에 접근 가능
        - 데이터 조작 연산 간소화: 애플리케이션이 원하는 형태의 논리적 구조를 형성하여 데이터 조작 연산을 간소화. 복수 테이블에 존재하는 여러 종류의 데이터에 대해 단순한 질의어 사용 가능.
        - 보안 기능(접근 제어) 제공: 특정 필드만을 선택해 뷰를 생성할 경우 애플리케이션은 선택되지 않은 필드의 조회 및 접근 불가. 중요 보안 데이터를 저장 중인 테이블이나 컬럼에는 접근 불허
    - **단점**
        - 뷰 자체 인덱스 불가: 인덱스는 물리적으로 저장된 데이터를 대상으로 하기때문에 논리적 구성인 뷰 자체는 인덱스를 가지지 못함
        - 뷰 변경 불가: 뷰의 정의를 변경하려면 삭제하고 재생성. 뷰 정의는 ALTER문을 이용하여 변경할 수 없음. CREATE 로 정의, DROP으로 제거
        - 데이터 변경 제약 존재: 뷰의 내용에 대한 삽입, 삭제, 변경 제약이 있음.

### 2) 인덱스

- 개념
    - 인덱스는 데이터를 빠르게 찾을 수 있는 수단으로서, 테이블에 대한 조회 속도를 높여 주는 자료 구조이다.
    - 테이블의 특정 레코드 위치를 알려주는 용도로 사용한다.
    - 기본 키 컬럼은 자동으로 인덱스가 생성된다.
    - 연월일이나 이름을 기준으로 하는 인덱스는 자동으로 생성되지 않는다.

### 3) 조인

- 개념
    - 두 개 이상의 테이블을 연결하여 데이터를 검색하는 방법이다.
    - 두 릴레이션으로부터 관련된 튜플들을 결합하여 하나의 튜플로 만드는 가장 대표적인 데이터 연결 방법이다.
    - 관계형 데이터베이스의 가장 큰 장점이면서 대표적인 핵심 기능이다.
- 유형
    - 논리적 조인: 사용자 SQL문에 표현되는 테이블 결합 방식. 내부 조인과 외부 조인이 해당된다.
    - 물리적 조인: 데이터베이스 옵티마이저에 의해 내부적으로 발생하는 테이블 결합 방식. 중첩 방복 조인, 정렬 합병 조인, 해시 조인이 해당된다.

### 4) 서브쿼리

- SQL 문 안에 포함된 또 다른 SQL문이다.
- 서브쿼리 유형
    - 동작하는 방식이나 반환되는 데이터의 형태에 따라 분류할 수 있다.
    - **동작 방식 기준 서브쿼리 유형**
        - 비연관 서브쿼리 : 서브쿼리가 메인쿼리의 컬럼을 가지고 있지 않은 형태. 메인쿼리에 서브쿼리에서 실행된 결과를 제공하는 용도로 사용
        - 연관 서브쿼리: 서브쿼리가 메인쿼리의 컬럼을 가지고 있는 형태. 메인쿼리가 먼저 수행되어 얻은 데이터를 서브쿼리의 조건에 맞는지 확인하는 용도로 사용
    - **데이터 형태 기준 서브쿼리 유형**
        - 단일 행 서브쿼리 : 결과가 항상 1건 이하인 서브쿼리. 단일행 비교 연산자 (=, <, ≤, >, ≥,<>) 가 사용
        - **다중 행 서브쿼리** : 실행 결과가 여러 건인 서브쿼리. 다중 행 비교 연산자 사용
            - **IN :** 서브쿼리의 결과에 존재하는 임의의 값과 동일한 조건을 의미
            - ALL: 서브쿼리의 결과에 존재하는 모든 값을 만족하는 조건을 의미
            - ANY: 서브쿼리의 결과에 존재하는 어느 하나의 값이라도 만족하는 조건을 의미
            - **EXIST:** 서브쿼리의 결과를 만족하는 값이 존재 여부를 확인하는 조건을 의미
        - 다중 컬럼 서브쿼리 : 결과가 여러 컬럼으로 반환되는 서브쿼리. 메인쿼리의 조건절에 여러 컬럼을 동시에 비교할 떄, 서브쿼리와 메인쿼리에서 비교하는 컬럼 개수와 위치가 동일해야함
    - 위치 기준 서브쿼리 유형
        - FROM 절 서브쿼리
        - WHERE 절 서브쿼리